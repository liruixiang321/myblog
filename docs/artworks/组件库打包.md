---
updateTime: "2024-08-20 14:25:26"
desc: "组件库打包相关知识"
tags: "组件库/打包"
---

# 对组件库进行打包 📦

整个打包的思路参考开源项目 element-plus,并结合实际的业务场景。进行梳理之后我们需要考虑以下几个问题：  
1.提供浏览器环境可以识别的代码（一般是 UMD 或 IIFE）  
2.提供 Node.js 环境的 CommonJS 规范的代码  
3.提供 ES Module 规范的代码  
4.提供 TypeScript 类型定义文件  
5.提供 CSS 样式文件  
6.提供 sourcemap 文件

## 为什么要提供 cjs 和 esm 两种代码 🏳️‍🌈

- 向后兼容：Node.js 的早期版本主要支持 CommonJS 模块系统。尽管 Node.js 现在也逐渐支持 ESM，但许多旧项目和库仍然使用 cjs 格式。提供 cjs 版本可以确保这些旧项目能够继续运行，无需进行大规模的迁移。

- 生态支持：虽然 ESM 是未来的趋势，但目前并不是所有的工具链和环境都完全支持 ESM。例如，某些构建工具或打包器可能仍然对 cjs 有更好的支持。提供 cjs 版本可以确保这些工具能够无缝地集成和使用库。

- 性能考虑：在某些情况下，cjs 可能提供更优的性能，因为它支持同步加载。虽然这在 Web 应用中通常不是最佳选择，但在 Node.js 环境中，特别是在启动时间不是首要考虑因素的情况下，cjs 可能是一个合理的选择。

- 开发者习惯：开发者对 cjs 和 esm 有不同的偏好。一些开发者可能更喜欢 cjs 的同步加载和更简单的语法，而另一些开发者则可能更喜欢 ESM 的原生支持和更好的静态分析能力。提供两种格式可以满足不同开发者的需求。

下面是尤大在 vite5 发布时对前端未来趋势的总结 🙌：

[!image]("../public/artworks/组件库打包1.png")

## 引入 ts 类型文件（vue-tsc,dts 插件）

## 使用 gulp 单独打包 css
